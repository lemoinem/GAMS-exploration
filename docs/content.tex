\section*{Presentation}

GAMS provides an interface to many solvers and various facilities to manipulate
the results of these solver. However, incremental exploration of sets of indices
are not well supported. The goal of this script and library is to provide such
facilities.

This documention describes the use of the shell script
\texttt{GAMS-exploration.lisp}. The library documentation is provided directly
in the source code.

It is important to note that this script currently support only the SBCL
implementation of common-lisp, more about this restriction in the Restriction
Section.

\section*{Licence and Copyright}
The script, library and their documentation are licensed under the 3-clause BSD
License:\\
Copyright \textcopyright{} 2010, Mathieu Lemoine\\
All rights reserved.\\
% 
Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:
\begin{itemize}
\item Redistributions of source code must retain the above copyright notice,
  this list of conditions and the following disclaimer.
\item Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.
\item Neither the name of Mathieu Lemoine nor the names of contributors may be
  used to endorse or promote products derived from this software without
  specific prior written permission.
\end{itemize}
% 
This software is provided by Mathieu Lemoine ''as is'' and any express or
implied warranties, including, but not limited to, the implied warranties of
merchantability and fitness for a particular purpose are disclaimed. In no event
shall Mathieu Lemoine be liable for any direct, indirect, incidental, special,
exemplary, or consequential damages (including, but not limited to, procurement
of substitute goods or services; loss of use, data, or profits; or business
interruption) however caused and on any theory of liability, whether in
contract, strict liability, or tort (including negligence or otherwise) arising
in any way out of the use of this software, even if advised of the possibility
of such damage.

\section*{Syntaxes}

The syntax of the various files is designed to be as close as possible to the
syntax of ordinary GAMS model files.

\subsection*{Command-line script}

The scrip required the following 9 mandatory arguments :
\begin{itemize}
\item \texttt{--initial-points}: directory where initial points will be
  stored. It must end with a trailing slash and be an existing directory;
\item \texttt{--sets}: list of sets of indices which are to be
  incrementally explored;
\item \texttt{--stops}: list of stop criteria used to stop exploration of
  the sets;
\item \texttt{--strategies}: list of strategies to be used to explore the dynamic
  sets;
\item \texttt{--gms}: GAMS model;
\item \texttt{--variables}: list of variables in the GAMS model;
\item \texttt{--current-sets}: file included in the GAMS model to load the
  dynamic sets. This file does not need to exists since it will be generated by
  the script;
\item \texttt{--current-point}: file included in the GAMS model to generate the
  start point. This file does not need to exists since it will be rewritten by
  the script;
\item \texttt{--solvers}: list of solvers to be used.
\end{itemize}

The following optional arguments are also available:
\begin{itemize}
\item \texttt{--lsts}: directory in which the lst generated by GAMS will be
  stored;
\item \texttt{--min}: file in which will be stored the minimal solution found so
  far;
\item \texttt{--max}: file in which will be stored the maximal solution found so
  far;
\item \texttt{--errors}: file in which the list of GAMS errors will be stored.
\end{itemize}

This list is printed by the script itself if the argument \texttt{--help} is
given. In this case, the script terminate after printing the list.

\subsection*{Dynamic sets file}

The dynamic sets file should contains a comma/new-line separated list of set descriptors.
A set descriptor is as follow:
\begin{center}
  \texttt{set-name[([start-size,[min-size,]]max-size)] [comment]}
\end{center}
It is important that no set-name is used as a label name in any other set since
it will be declared as a phantom label.

\subsection*{Stop criteria file}

The stop criteria file is the only one not respecting a syntax close to the
GAMS's one. This file usualy needs only to exist and be empty unless you need to
specify advanced stop criteria. The stop criteria must be written in Common-Lisp
and using the helper macros \texttt{sets-max-size}, \texttt{sets-min-size} and
\texttt{def-stop-criterion} in \texttt{backend/stop-criteria.lisp}. These macros
documentation is available directly in the source code.

\subsection*{Strategies file}

The strategies file contains a comma/new-line separated list of strategy
descriptiors. Each strategy descriptor represent a strategy that will be used
to generate new initial points during the dynamic sets exploration.
A strategy descriptor is as follow:
\begin{center}
  \texttt{strategy-file-name(derivation [, [set] [, stage]]) [comment]}
\end{center}
Since they are litterals, the values of \texttt{derivation} and \texttt{stage}
should be enclosed in single quotes.

\begin{itemize}
\item the strategy-file-name file must be written in GAMS, its content will be
  included in the model to complete the initialization of the initial-point, as
  if included using:
  \texttt{\$batinclude strategy-file-name [new-set-element [old-set-element]]}.
  \begin{itemize}
  \item \texttt{new-set-element} will be present only if the derivation is
    \texttt{derived} or \texttt{family} and will be the element that has just
    been added in the currently explored dynamic set;
  \item \texttt{old-set-element} will be present only if the derivation is
    \texttt{family} and will be the element of the current set that is currently
    used to generate a new point.
  \end{itemize}
\item \texttt{derivation}, if present, must be one of:
  \begin{itemize}
  \item \texttt{i[ndependent]}, this is the default;
  \item \texttt{d[erived]};
  \item \texttt{f[amily]}.
  \end{itemize}
\item \texttt{set}, if present, must be the name of a dynamic set;
\item \texttt{stage}, if present, must be one of:
  \begin{itemize}
  \item \texttt{e[mpty-set]};
  \item \texttt{1} or \texttt{f[irst-element]};
  \item \texttt{n} or \texttt{a[dditional-element]}, this is the default if
    \texttt{derivation} is \texttt{family};
  \item \texttt{*} or \texttt{A[lways]}, this is the default if
    \texttt{derivation} is \texttt{independent};
  \item \texttt{+} or \texttt{N[on-empty-set]}, this is the default if
    \texttt{derivation} is \texttt{derived}.
  \end{itemize}
\end{itemize}

The following restrictions apply:
\begin{itemize}
\item if \texttt{derivation} is \texttt{derived} or \texttt{family},
  \texttt{stage} must be neither \texttt{empty-set} nor \texttt{always};
\item if \texttt{derivation} is \texttt{family}, \texttt{stage} must be neither
  \texttt{first-element} nor \texttt{non-empty-set} (i.e. if \texttt{derivation}
  is \texttt{family}, \texttt{stage} must be \texttt{additional-element}).
\end{itemize}

\subsection*{GAMS model}

The \texttt{GAMS-model.gms} is a regular GAMS model. No major restriction apply
to it.

However, for the script to function, two files must be included within the
model:
\begin{itemize}
\item the \texttt{set-point.inc} file must be included before the use of any
  dynamic set in the model file;
\item the \texttt{initializer.inc} file must be included before the
  \texttt{solve} statement.
\end{itemize}

Moreover, only one solve statement should be included in the model. Otherwise,
only the point generated by the last solve statement will be stored unless any
solve statement generates no data (in which case no result point will be
stored).

\subsection*{Variables list file}

The \texttt{variables.inc} file is a regular GAMS file presenting the list of
variables to be stored when a result point is stored. The variables not present
in this file will be ignored. The variables that are on lines not starting by a
space are ignored.

\subsection*{Solvers file}

The \texttt{solvers} file should contain a list of solver options to use. Each
line may be either \og default\fg{} or a set of options to change the default
GAMS sovlers for any kind of program.

\subsection*{Generated files}

The \texttt{set-point.inc} and \texttt{initializer.inc} files are generated by
the script. Their names should be specified on the command-line so the user is
free to name them as he want.

\section*{Behaviour}

The script explores the dynamic sets space using a breadth-first exploration:

The initial set-point is created by assigning to each set its start size (which
is 0 if unspecified).

For each set-point to explore, a set of strategies are used to generate initial
points (Unless a stop-criterion is reached).

\texttt{derivation} determines how the new point is generated by the strategy:
\begin{itemize}
\item \texttt{independent} means that the strategy does not required any a
  priori information to generate a new point;
\item \texttt{derived} means that the strategy generates a new initiail point by
  slightly modifying a previous exploration result point. These strategies are
  used to generate a new point for each feasible point generated by the previous
  exploration step. The point will be loaded in GAMS before the strategy file is
  included using \texttt{\$batinclude strategy-file-name new-set-element};
\item \texttt{family} means that the strategy generates a new initial point by
  slightly modifying a previous exploration result point for each element in the
  current set during the previous exploration step. These strategies are used to
  generate a new point for each feasible point generated by and each element is
  the currently explored set during the previous exploration step. The point
  will be loaded in GAMS before the strategy file is included using
  \texttt{\$batinclude strategy-file-name new-set-element old-set-element}.
\end{itemize}

\texttt{stage} determines when the strategy is used (with respect to the state
of each set):
\begin{itemize}
\item \texttt{empty-set} means that the strategy will be used only when all the
  sets (unless a set is specified) are empty;
\item \texttt{first-element} means that the strategy will be used only when the
  currently explored set receives its first element;
\item \texttt{additional-element} means that the strategy will be used only when
  the currently explored set receives an additional element (i.e. not its first
  one);
\item \texttt{always} means that the strategy will be always used;
\item \texttt{non-empty-set} means that the strategy will be used only when the
  currently explored set receives an element (i.e. its first one or another
  one).
\end{itemize}

After the set-point has been explored, new set-points obtained by adding an
element to each set is added to the list of set-point to explore.

When no more set-point remains to be explored (because they all reached a
stop-criterion), the last set reaches stop criteria, the exploration is stoped
and the best and worst feasible points (actually, minimum and maximum) are
printed on the screen. A list of the errors generated by GAMS is also printed.

The initial points files are all in the initial-points directory. Moreover, the
lst file of each GAMS run is preserved (if the --lsts arguments is specified).

\section*{Restrictions}

The script depends on the following libraries:
\begin{itemize}
\item \texttt{alexandria}: \url{http://common-lisp.net/project/alexandria/};
\item \texttt{cl-fad}: \url{http://weitz.de/cl-fad/};
\item \texttt{cl-ppcre}: \url{http://www.cliki.net/cl-ppcre};
\item \texttt{split-sequence}: \url{http://www.cliki.net/parse-number};
\item \texttt{script-utility}: No URL is currently available, please contact the
  script author.
\item \texttt{priority-fifo}: No URL is currently available, please contact the
  script author.
\end{itemize}

As mentionned in the presentation, this script currently supports only SBCL.
The details of this restriction are:
\begin{itemize}
\item the library \texttt{script-utility} currently supports only SBCL;
\item the script is run using the sbcl script interpreter;
\item the function \texttt{solve-GAMS-model} in \texttt{frontend/GAMS.lisp}
  currently supports only SBCL.
\end{itemize}
